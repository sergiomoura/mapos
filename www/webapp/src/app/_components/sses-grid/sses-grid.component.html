<div class="container-80 top-gap padding">
	<div class="container-filtro">
		<!--
		<div class="container-selects">
			<mat-form-field>
				<mat-select [(ngModel)]="busca.equipes"  placeholder="Equipes" multiple>
					<mat-option *ngFor="let equipe of equipes" [value]="equipe">[{{equipe.sigla}}] {{equipe.nome}}</mat-option>
				</mat-select>
			</mat-form-field>
	
			<mat-form-field>
				<mat-select [(ngModel)]="busca.status"  placeholder="Status" multiple>
					<mat-option value="CADASTRADA">Cadastradas</mat-option>
					<mat-option value="AGENDADA">Agendadas</mat-option>
					<mat-option value="EXECUTANDO">Executando</mat-option>
					<mat-option value="PENDENTE">Pendentes</mat-option>
					<mat-option value="FINALIZADA">Finalizadas</mat-option>
					<mat-option value="DIVERGENTE">Divergentes</mat-option>
					<mat-option value="CANCELADA">Canceladas</mat-option>
					<mat-option value="RETRABALHO">Retrabalho</mat-option>
				</mat-select>
			</mat-form-field>
	
			<mat-form-field>
				<mat-select [(ngModel)]="busca.prioridades"  placeholder="Nivel de Prioridade" multiple>
					<mat-option [value]="0">Normal</mat-option>
					<mat-option [value]="1">Prioridade</mat-option>
					<mat-option [value]="2">Urgente</mat-option>
				</mat-select>
			</mat-form-field>
		</div>

		<div class="container-datas">
			<mat-form-field>
				<input matInput [max]="busca.agendadas_ate" [(ngModel)]="busca.agendadas_de" [matDatepicker]="picker1" placeholder="Agendados de">
				<mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
				<mat-datepicker #picker1></mat-datepicker>
			</mat-form-field>
			<mat-form-field>
				<input matInput [min]="busca.agendadas_de" [(ngModel)]="busca.agendadas_ate" [matDatepicker]="picker2" placeholder="Agendados até">
				<mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
				<mat-datepicker #picker2></mat-datepicker>
			</mat-form-field>
			<mat-form-field>
				<input matInput [max]="busca.realizadas_ate" [(ngModel)]="busca.realizadas_de" [matDatepicker]="picker3" placeholder="Realizados de">
				<mat-datepicker-toggle matSuffix [for]="picker3"></mat-datepicker-toggle>
				<mat-datepicker #picker3></mat-datepicker>
			</mat-form-field>
			<mat-form-field>
				<input matInput [min]="busca.realizadas_de" [(ngModel)]="busca.realizadas_ate" [matDatepicker]="picker4" placeholder="Realizados até">
				<mat-datepicker-toggle matSuffix [for]="picker4"></mat-datepicker-toggle>
				<mat-datepicker #picker4></mat-datepicker>
			</mat-form-field>
		</div>

		<div class="controles">
			<button mat-raised-button color="accent" (click)="onResetCamposClick()">Resetar Campos</button>
			<button mat-raised-button color="primary" class="bt-buscar" (click)="onBuscarClick()">Buscar</button>
		</div>

	</div>
	-->
	<app-buscador
			#buscador
			[cmp]="true"
			[cmo]="true"
			(ssesCarregadas)="onSsesCarregadas($event)"
			[equipes]="equipes"
			[bairros]="bairros"
			[auto]="true">
	</app-buscador>
</div>

<div class="resultados-container">
	<table class="tb-resultados">
		<thead>
			<tr>
				<td colspan="25">Dados da SSE</td>
				<td colspan="5">Dados do 1º Serviço</td>
				<td colspan="5">Dados do 2º Serviço</td>
			</tr>
			<tr>
				<td>ID</td>
				<td>Status</td>
				<td>Nº SSE</td>
				<td>Data Recebimento SSE</td>
				<td>Nº Domasa</td>
				<td>Endereço</td>
				<td>ID Bairro</td>
				<td>Nome Bairro</td>
				<td>Obs</td>
				<td>Tot Medidas Prev</td>
				<td>Tot Medidas Real</td>
				<td>Dif. Medidas</td>
				<td>Divergência?</td>
				<td>TDS Prev</td>
				<td>TDS Real</td>
				<td>Dif. TDS</td>
				<td>Classificação</td>
				<td>Classificação (Alteração)</td>
				<td>Prioridade</td>
				<td>DL Execução</td>
				<td>Data Devolução</td>
				<td>DL Garantia</td>
				<td>Em Garantia?</td>
				<td>Cálculo Execução</td>
				<td>Valor da SSE</td>
				<td>Equipe</td>
				<td>Apoio</td>
				<td>Agendado para</td>
				<td>Data da Execução</td>
				<td>Consumo</td>
				<td>Equipe</td>
				<td>Apoio</td>
				<td>Agendado para</td>
				<td>Data da Execução</td>
				<td>Consumo</td>
			</tr>
		</thead>
		<tbody *ngFor="let sse of sses">
			<tr>
				<td>{{sse.id}}</td>
				<td>{{sse.status}}</td>
				<td>{{sse.numero}}</td>
				<td>{{sse.dh_recebido | date:"dd/MM/yyyy"}}</td>
				<td>{{sse.bairro.domasa}}</td>
				<td>{{sse.endereco}}</td>
				<td>{{sse.bairro?.codigo}}</td>
				<td>{{sse.bairro?.nome}}</td>
				<td>{{sse.obs}}</td>
				<td>{{getTotalPrev(sse).toString()}}</td>
				<td>{{ getTotalReal(sse)?.toString()}}</td>
				<td>{{ getDifMedida(sse) }}</td>
				<td>{{ getDivergencia(sse) }}</td>
				<td>{{ sse.tipoDeServicoPrev?.codigo}}</td>
				<td>{{ sse.tipoDeServicoReal?.codigo}}</td>
				<td>{{ getDifTds(sse) }}</td>
				<td>{{sse.faixaPrev?.label}} ({{sse.faixaPrev?.li}} < X {{ +sse.faixaPrev?.ls == infinito ? '' : '≤ ' + sse.faixaPrev?.ls}})</td>
				<td>{{sse.faixa_real_label}}</td>
				<td>{{sse.label_urgencia}}</td>
				<td>{{sse.prazoFinal | date:'dd/MM/yyyy'}}</td>
				<td>{{sse.label_data_devolucao}}</td>
				<td>{{sse.label_dl_garantia}}</td>
				<td>{{sse.label_em_garantia}}</td>
				<td>{{sse.calc_exec}}</td>
				<td>{{sse.valor_real | currency:'BRL':symbol:'1.2-2' | moedaBrasil}}</td>

				<!-- INÍCIO DE EXIBIÇÃO DE TAREFA 1-->
				<td>{{sse.tarefas.length > 0 && sse.tarefas[0].equipe ? sse.tarefas[0].equipe.nome : ''}}</td>
				<td>{{sse.tarefas.length > 0 && sse.tarefas[0].apoio ? sse.tarefas[0].apoio.nome : ''}}</td>
				<td>{{sse.tarefas.length > 0 && sse.tarefas[0].inicio_p ? (sse.tarefas[0].inicio_p|date:'dd/MM/yyyy') : ''}}</td>
				<td>{{sse.tarefas.length > 0 && sse.tarefas[0].final_r ? (sse.tarefas[0].final_r|date:'dd/MM/yyyy') : ''}}</td>
				<td>
					<ul *ngIf="sse.tarefas.length > 0 && sse.tarefas[0].consumos.length > 0">
						<li *ngFor="let c of sse.tarefas[0].consumos">
							{{c.nome}} : {{c.qtde}} {{c.unidade}}
						</li>
					</ul>
				</td>
				<!-- FINAL DE EXIBIÇÃO DE TAREFA 1 -->

				<!-- INÍCIO DE EXIBIÇÃO DE TAREFA 2-->
				<td>{{sse.tarefas.length > 1 && sse.tarefas[1].equipe ? sse.tarefas[1].equipe.nome : ''}}</td>
				<td>{{sse.tarefas.length > 1 && sse.tarefas[1].apoio ? sse.tarefas[1].apoio.nome : ''}}</td>
				<td>{{sse.tarefas.length > 1 && sse.tarefas[1].inicio_p ? (sse.tarefas[1].inicio_p|date:'dd/MM/yyyy') : ''}}</td>
				<td>{{sse.tarefas.length > 1 && sse.tarefas[1].final_r ? (sse.tarefas[1].final_r|date:'dd/MM/yyyy') : ''}}</td>
				<td>
					<ul *ngIf="sse.tarefas.length > 1 && sse.tarefas[1].consumos.length > 1">
						<li *ngFor="let c of sse.tarefas[1].consumos">
							{{c.nome}} : {{c.qtde}} {{c.unidade}}
						</li>
					</ul>
				</td>
				<!-- FINAL DE EXIBIÇÃO DE TAREFA 2 -->
			</tr>
			
		</tbody>
	</table>
</div>
